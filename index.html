<!DOCTYPE html>
<html lang="ku" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <link href="https://fonts.googleapis.com/css2?family=Vazirmatn:wght@400;700&display=swap" rel="stylesheet">
    <title>H-SYSTEM SECURE</title>
    <style>
        body { font-family: 'Vazirmatn', sans-serif; background: #f8fafc; }
        .patient-card { transition: all 0.3s ease; }
        .patient-card:hover { transform: translateY(-2px); }
    </style>
</head>
<body class="p-4 md:p-8">

    <div class="max-w-5xl mx-auto">
        <header class="text-center mb-10">
            <h1 class="text-3xl font-bold text-indigo-900">ğŸ¥ Ø³ÛŒØ³ØªÛ•Ù…Û ØªÛ†Ù…Ø§Ø±Ú©Ø±Ù†Ø§ Ù†Û•Ø®Û†Ø´Ø§Ù†</h1>
            <p class="text-slate-500">Ù¾Ø§Ø±Ø§Ø³ØªÛŒ Ùˆ ØªØ§ÛŒØ¨Û•Øª</p>
        </header>

        <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
            <div class="lg:col-span-1">
                <div class="bg-white p-6 rounded-2xl shadow-lg border border-indigo-100">
                    <form id="pForm" class="space-y-4">
                        <input type="text" id="name" placeholder="Ù†Ø§Ú¤Û Ù†Û•Ø®Û†Ø´ÛŒ" class="w-full p-3 border rounded-xl outline-none focus:ring-2 focus:ring-indigo-500" required>
                        <div class="grid grid-cols-2 gap-2">
                            <input type="number" id="age" placeholder="ØªÛ•Ù…Û•Ù†" class="w-full p-3 border rounded-xl outline-none" required>
                            <input type="text" id="phone" placeholder="Ù…Û†Ø¨Ø§ÛŒÙ„" class="w-full p-3 border rounded-xl outline-none">
                        </div>
                        <textarea id="illness" placeholder="ÙˆÛ•Ø³ÙÛ Ù†Û•Ø®Û†Ø´ÛŒÛ" class="w-full p-3 border rounded-xl outline-none"></textarea>
                        <button type="submit" class="w-full bg-indigo-600 text-white py-3 rounded-xl font-bold hover:bg-indigo-700 transition">Ù¾Ø§Ø´Ú©Û•ÙØª Ø¨Ú©Û•</button>
                    </form>
                </div>
            </div>

            <div class="lg:col-span-2 space-y-4">
                <input type="text" id="search" onkeyup="searchPatient()" placeholder="ğŸ” Ú¯Û•Ú•ÛŒØ§Ù† Ù„ Ù†Ø§Ú¤ÛŒ..." class="w-full p-3 rounded-xl shadow-sm border outline-none focus:ring-2 focus:ring-indigo-400">
                <div id="patientList" class="space-y-4">
                    <p class="text-center text-gray-400 py-10">Ù„ Ú†Ø§ÙˆÛ•Ú•ÛÛŒØ§ Ø¯Ø§ØªØ§ÛŒÛ...</p>
                </div>
            </div>
        </div>
    </div>

    <script>
        const PRIVATE_KEY = '112233'; // Ø¯Ú¤ÛØª ÙˆÛ•Ú© ÛŒØ§ Ø³ÛØ±Ú¤Û•Ø±ÛŒ Ø¨ÛŒØª
        const API_URL = '/api/patients';
        let allData = [];

        async function login() {
            const { value: pass } = await Swal.fire({
                title: 'Ú†ÙˆÙˆÙ†Û•Ú˜ÙˆÙˆØ±Û',
                input: 'password',
                confirmButtonText: 'Login',
                allowOutsideClick: false
            });
            if (pass === PRIVATE_KEY) {
                fetchData();
            } else {
                Swal.fire('Error', 'Ú©Ù„ÛŒÙ„ Ø®Û•Ù„Û•ØªÛ•', 'error').then(login);
            }
        }

        async function fetchData() {
            try {
                const res = await fetch(API_URL, { headers: { 'Authorization': PRIVATE_KEY } });
                allData = await res.json();
                render(allData);
            } catch (err) {
                console.error("Fetch error");
            }
        }

        function render(data) {
            const list = document.getElementById('patientList');
            list.innerHTML = data.map(p => `
                <div class="bg-white p-4 rounded-xl shadow-sm border-r-4 border-indigo-600 patient-card">
                    <div class="flex justify-between">
                        <span class="font-bold text-gray-800">${p.name}</span>
                        <span class="text-xs text-gray-400">${p.date}</span>
                    </div>
                    <p class="text-sm text-gray-500 mt-1">ØªÛ•Ù…Û•Ù†: ${p.age} | Ù…Û†Ø¨Ø§ÛŒÙ„: ${p.phone}</p>
                    <p class="text-indigo-700 mt-2 text-sm font-medium">${p.illness || '...'}</p>
                </div>
            `).join('');
        }

        function searchPatient() {
            const val = document.getElementById('search').value.toLowerCase();
            const filtered = allData.filter(p => p.name.toLowerCase().includes(val));
            render(filtered);
        }

        document.getElementById('pForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            const data = {
                name: document.getElementById('name').value,
                age: document.getElementById( 'age').value,
                phone: document.getElementById('phone').value,
                illness: document.getElementById('illness').value
            };
            const res = await fetch(API_URL, {
                method: 'POST',
                headers: { 'Content-Type': 'application/json', 'Authorization': PRIVATE_KEY },
                body: JSON.stringify(data)
            });
            if (res.ok) {
                Swal.fire({ icon: 'success', title: 'ØªÛ†Ù…Ø§Ø± Ø¨ÙˆÙˆ', timer: 1000, showConfirmButton: false });
                e.target.reset();
                fetchData();
            }
        });

        window.onload = login;
    </script>
</body>
</html>
